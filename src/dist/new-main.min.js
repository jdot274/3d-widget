"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var scene,camera,renderer,grid,THREE=_interopRequireWildcard(require("three")),_Grid=_interopRequireDefault(require("./components/Grid.js")),_sceneConfig=_interopRequireDefault(require("./scene.config.json"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache();if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var o=i?Object.getOwnPropertyDescriptor(e,t):null;o&&(o.get||o.set)?Object.defineProperty(n,t,o):n[t]=e[t]}return n.default=e,r&&r.set(e,n),n}var envMap,animationFrameId=null,mouse=new THREE.Vector2,raycaster=new THREE.Raycaster,hoveredChip=null,clock=new THREE.Clock;function init(){console.log("Initializing 3D scene"),(scene=new THREE.Scene).background=null,(camera=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,.1,1e3)).position.z=7,camera.position.y=1.5,camera.lookAt(0,0,0),(renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,precision:"highp"})).setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(0,0),renderer.setClearAlpha(0),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),void 0!==renderer.physicallyCorrectLights&&(renderer.physicallyCorrectLights=!0),void 0!==THREE.sRGBEncoding&&(renderer.outputEncoding=THREE.sRGBEncoding),void 0!==THREE.ACESFilmicToneMapping&&(renderer.toneMapping=THREE.ACESFilmicToneMapping,renderer.toneMappingExposure=.9),createEnvironmentMap(),scene.renderer=renderer,scene.envMap=envMap,document.getElementById("app").appendChild(renderer.domElement),setupLighting(),grid=new _Grid.default(scene),console.log("Grid created:",grid),window.addEventListener("resize",onWindowResize),window.addEventListener("mousemove",onMouseMove),window.addEventListener("click",onClick),animate()}function createEnvironmentMap(){try{if(renderer&&THREE.PMREMGenerator){var e=new THREE.PMREMGenerator(renderer);e.compileEquirectangularShader();var r=createPremiumEnvironmentTexture();envMap=e.fromEquirectangular(r).texture,e.dispose(),r.dispose()}}catch(e){console.warn("Error creating environment map:",e)}}function createPremiumEnvironmentTexture(){var e=document.createElement("canvas");e.width=2048,e.height=1024;var r=e.getContext("2d");r.clearRect(0,0,e.width,e.height);var n=r.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,.8*e.height);n.addColorStop(0,"rgba(30, 30, 30, 0.1)"),n.addColorStop(.3,"rgba(20, 20, 20, 0.05)"),n.addColorStop(.6,"rgba(10, 10, 10, 0.03)"),n.addColorStop(1,"rgba(0, 0, 0, 0)"),r.fillStyle=n,r.fillRect(0,0,e.width,e.height),r.globalCompositeOperation="lighter";for(var i=0;i<10;i++){var t=Math.random()*e.width,o=Math.random()*e.height,a=60+100*Math.random(),d=r.createRadialGradient(t,o,0,t,o,a);d.addColorStop(0,"rgba(255, 255, 255, 0.1)"),d.addColorStop(.3,"rgba(255, 255, 255, 0.03)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),r.fillStyle=d,r.beginPath(),r.arc(t,o,a,0,2*Math.PI),r.fill()}r.globalCompositeOperation="source-over";var c=new THREE.CanvasTexture(e);return THREE.EquirectangularReflectionMapping&&(c.mapping=THREE.EquirectangularReflectionMapping),c}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onMouseMove(e){mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera);var r=raycaster.intersectObjects(scene.children,!0);if(!hoveredChip||r.length&&r[0].object.userData.chip===hoveredChip||(hoveredChip.onHover(!1),hoveredChip=null),0<r.length){var n=r[0].object.userData.chip;n&&n!==hoveredChip&&(hoveredChip=n).onHover(!0)}}function onClick(){hoveredChip&&hoveredChip.onClick()}function animate(){animationFrameId=requestAnimationFrame(animate);var e=clock.getElapsedTime();if(grid&&grid.chips){var r=!0,n=!1,i=void 0;try{for(var t,o=grid.chips[Symbol.iterator]();!(r=(t=o.next()).done);r=!0){t.value.update(e)}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}var a=.03*Math.sin(.07*e),d=.03*Math.cos(.05*e)+1.5;camera.position.x=a,camera.position.y=d,camera.position.z=7,camera.lookAt(0,0,0),renderer.setClearColor(0,0),renderer.setClearAlpha(0),renderer.clear(),renderer.render(scene,camera)}function cleanup(){animationFrameId&&cancelAnimationFrame(animationFrameId),window.removeEventListener("resize",onWindowResize),window.removeEventListener("mousemove",onMouseMove),window.removeEventListener("click",onClick),grid&&grid.dispose(),renderer&&renderer.dispose(),envMap&&envMap.dispose()}function setupLighting(){var e=new THREE.AmbientLight(16777215,.4);scene.add(e);var r=new THREE.DirectionalLight(16777215,.6);r.position.set(3,5,4),scene.add(r);var n=new THREE.DirectionalLight(16777215,.4);n.position.set(-4,3,4),scene.add(n);var i=new THREE.DirectionalLight(16777215,.2);i.position.set(0,-4,2),scene.add(i);var t=new THREE.PointLight(16777215,.2,10);t.position.set(2,3,4),scene.add(t);var o=new THREE.PointLight(16777215,.15,8);o.position.set(-3,-2,3),scene.add(o)}init(),window.addEventListener("beforeunload",cleanup);
//# sourceMappingURL=new-main.min.js.map
